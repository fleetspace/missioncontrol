service:
  name: missioncontrol
  port: 8000
  healthEndpoint: /
  desiredCount: 1
  pathPatterns:
  - /*
  pipeline:
    source:
      branch: mu
  database:
    name: missioncontrol
    engine: aurora-postgresql
    engineMode: serverless
    secondsUntilAutoPause: 300
    # https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/aurora-serverless.create.html
    # Valid values: Aurora PostgreSQL: 8, 16, 32, 64, 192, and 384.
    minSize: 2
    maxSize: 192
    masterUsername: missioncontrol


  environment:
    DJANGO_SETTINGS_MODULE: config.settings.production
    DJANGO_SECRET_KEY: '{{resolve:ssm:DJANGO_SECRET_KEY:1}}'
    DJANGO_JWT_SECRET: '{{resolve:ssm:DJANGO_JWT_SECRET:1}}'
    DJANGO_ADMIN_URL: admin/
    DJANGO_ALLOWED_HOSTS: '*'
    POSTGRES_HOST: ${DatabaseEndpointAddress}
    POSTGRES_PORT: ${DatabaseEndpointPort}
    POSTGRES_USER: ${DatabaseMasterUsername}
    POSTGRES_PASSWORD: ${DatabaseMasterPassword}

environments:
  - name: production
    provider: ecs-fargate
    cluster:
      instanceType: t2a.nano
    loadbalancer:
      certificate: 'xxxyyzz'
  - name: acceptance
    provider: ecs-fargate
    cluster:
      instanceType: t2a.nano




templates:
  mu-pipeline-missioncontrol:
    Resources:
      CodeBuildImage:
        Properties:
          Environment:
            EnvironmentVariables:
            - Name: DJANGO_SETTINGS_MODULE
              Value: config.settings.production
